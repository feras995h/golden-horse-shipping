# ๐ฏ ููุฎุต ุงูุญู ุงูููุงุฆู - ูุดููุฉ ุงููุดุฑ ุนูู Coolify

## ๐ ูุธุฑุฉ ุนุงูุฉ

**ุงูุชุงุฑูุฎ:** 2 ุฃูุชูุจุฑ 2025  
**ุงููุดููุฉ:** ูุดู ุงููุดุฑ ุนูู Coolify - ุฎุทุฃ ูู ุงูุงุชุตุงู ุจูุงุนุฏุฉ ุงูุจูุงูุงุช  
**ุงูุญุงูุฉ:** โ **ุชู ุงูุญู ูุงูุงุฎุชุจุงุฑ**

---

## โ ุงููุดููุฉ ุงูุฃุตููุฉ

### ุงูุฎุทุฃ ูู ุณุฌูุงุช Coolify:
```
Error: getaddrinfo EAI_AGAIN base
[TypeOrmModule] Unable to connect to the database. Retrying...
```

### ุงูุณุจุจ ุงูุฌุฐุฑู:
ุงูุชุทุจูู ูุญุงูู ุงูุงุชุตุงู ุจูุถูู ูุณูู **"base"** ุจุฏูุงู ูู ุนููุงู ูุงุนุฏุฉ ุงูุจูุงูุงุช ุงููุนูู **72.60.92.146**.

### ุงูุชุญููู:
- ูุชุบูุฑุงุช ุงูุจูุฆุฉ ููุงุนุฏุฉ ุงูุจูุงูุงุช ุบูุฑ ูุญุฏุฏุฉ ูู Coolify
- TypeORM ูุณุชุฎุฏู ููู ุงูุชุฑุงุถูุฉ ุนูุฏูุง ูุง ูุฌุฏ ุงูุฅุนุฏุงุฏุงุช
- "base" ูู ุงููููุฉ ุงูุงูุชุฑุงุถูุฉ ูููุถูู ูู ุจุนุถ ุงูุฅุนุฏุงุฏุงุช

---

## โ ุงูุญู ุงููุทุจู

### 1. ุชุญุฏูุซ ุงูููุฏ (backend/src/config/database.config.ts)

#### ุงูุชุญุณููุงุช ุงููุทุจูุฉ:
- โ ุฅุถุงูุฉ ุฑุณุงุฆู ุชุตุญูุญ ุดุงููุฉ ูุชุชุจุน ุงูุฅุนุฏุงุฏุงุช
- โ ุชุบููุฑ ุฃููููุฉ ุงูุงุชุตุงู: ุงููุชุบูุฑุงุช ุงููุฑุฏูุฉ ุฃููุงูุ ุซู DATABASE_URL
- โ ุฑุณุงุฆู ุฎุทุฃ ูุงุถุญุฉ ุนูุฏ ููุต ุงูุฅุนุฏุงุฏุงุช
- โ ุฏุนู ุฃูุถู ููุณููุงุฑูููุงุช ุงููุฎุชููุฉ

#### ูุซุงู ุนูู ุงูุฑุณุงุฆู ุงูุฌุฏูุฏุฉ:
```typescript
console.log('๐ Database Configuration Debug:');
console.log('  - NODE_ENV:', nodeEnv);
console.log('  - DATABASE_URL:', databaseUrl ? `${databaseUrl.substring(0, 30)}...` : 'NOT SET');
console.log('  - DB_HOST:', this.configService.get('DB_HOST'));
console.log('  - Is PostgreSQL:', isPostgres);
console.log('โ Using individual database variables');
```

### 2. ุงุฎุชุจุงุฑ ุงูุงุชุตุงู ุจูุงุนุฏุฉ ุงูุจูุงูุงุช

ุชู ุฅูุดุงุก ุณูุฑูุจุช ุดุงูู: `backend/test-db-connection.js`

#### ูุชุงุฆุฌ ุงูุงุฎุชุจุงุฑ:
```
โ DATABASE_URL method: SUCCESS
   - PostgreSQL 17.6 on x86_64-pc-linux-musl
   - Host: 72.60.92.146:5433
   - SSL: Not supported (and not needed)

โ Individual variables method: FAILED
   - Reason: SSL not supported error
```

#### ุงูุงุณุชูุชุงุฌ:
ุงุณุชุฎุฏุงู **DATABASE_URL** ูู ุงูุญู ุงูุฃูุซู ูุงูุฃูุซุฑ ููุซูููุฉ.

### 3. ุชูุซูู ุดุงูู

ุชู ุฅูุดุงุก ุนุฏุฉ ูููุงุช ุชูุซูู:

#### ูููุงุช ุงูุจุฏุก ุงูุณุฑูุน:
- โ `ุฎุทูุงุช-ุณุฑูุนุฉ-ูููุดุฑ.txt` - ุฏููู ุณุฑูุน ุจุงูุนุฑุจูุฉ (3 ุฏูุงุฆู)
- โ `RECOMMENDED_ENV_VARS.txt` - ุงููุชุบูุฑุงุช ุงูููุตู ุจูุง ูููุณุฎ ุงููุจุงุดุฑ

#### ูููุงุช ุงูุชูุซูู ุงูุดุงูู:
- โ `README_DEPLOYMENT.md` - ุฏููู ุงููุดุฑ ุงูุฑุฆูุณู
- โ `DATABASE_CONNECTION_TEST_RESULTS.md` - ูุชุงุฆุฌ ุงุฎุชุจุงุฑ ุงูุงุชุตุงู
- โ `DEPLOYMENT_FIXES_SUMMARY.md` - ููุฎุต ุงูุฅุตูุงุญุงุช ุงูุชูููุฉ
- โ `COOLIFY_DEPLOYMENT_GUIDE.md` - ุฏููู Coolify ุงูุชูุตููู

---

## ๐ง ุงูุฅุนุฏุงุฏุงุช ุงููุทููุจุฉ

### ุงููุชุบูุฑุงุช ุงูุฃุณุงุณูุฉ (ุฃุถููุง ูู Coolify):

```bash
# Database Connection (ุงูุฃูู!)
DATABASE_URL=postgres://postgres:A93zhpdV6icewK6rxbBQRScmxZvyWAhjvXg2QJApIKzU0gVx8CzubNgvo2O97n1l@72.60.92.146:5433/postgres

# Server Configuration
NODE_ENV=production
PORT=3000
BACKEND_PORT=3001
FRONTEND_PORT=3000

# Database Behavior
DB_SYNCHRONIZE=true
DB_LOGGING=false

# JWT Authentication
JWT_SECRET=GoldenHorse-JWT-Secret-Key-2024-Production-Change-This
JWT_EXPIRES_IN=7d

# CORS & URLs
CORS_ORIGIN=*
FRONTEND_URL=http://localhost:3000

# Application Info
APP_NAME=Golden Horse Shipping
APP_VERSION=1.0.0
DEFAULT_LANGUAGE=ar
UPLOAD_PATH=/app/uploads

# ShipsGo API
SHIPSGO_API_URL=https://api.shipsgo.com/v1
SHIPSGO_API_KEY=6eada10b-fcd9-4ab8-ba19-3e2cb33fc1fa
SHIPSGO_USE_MOCK=false

# Next.js
NEXT_TELEMETRY_DISABLED=1
```

### โ๏ธ ูุชุบูุฑุงุช ูุฌุจ ุนุฏู ุฅุถุงูุชูุง:
```bash
โ DB_SSL=true  # ูุงุนุฏุฉ ุงูุจูุงูุงุช ูุง ุชุฏุนู SSL
โ DB_SSL_REJECT_UNAUTHORIZED=false  # ุบูุฑ ูุทููุจ
โ DB_HOST, DB_PORT, DB_USERNAME, DB_PASSWORD, DB_NAME  # ุงุณุชุฎุฏู DATABASE_URL ุจุฏูุงู ูููุง
```

---

## ๐ ุฎุทูุงุช ุงููุดุฑ

### ุงูุจุณูุทุฉ (3 ุฎุทูุงุช):
1. ุงูุชุญ Coolify โ Environment Variables
2. ุฃุถู ุงููุชุบูุฑุงุช ูู `RECOMMENDED_ENV_VARS.txt`
3. ุงุญูุธ ูุฃุนุฏ ุงููุดุฑ (Save โ Redeploy)

### ุงูุชูุตูููุฉ:
ุฑุงุฌุน `README_DEPLOYMENT.md` ุฃู `ุฎุทูุงุช-ุณุฑูุนุฉ-ูููุดุฑ.txt`

---

## โ ุงูุชุญูู ูู ุงููุฌุงุญ

### ูู ุณุฌูุงุช Coolifyุ ุงุจุญุซ ุนู:

**โ ุฑุณุงุฆู ุงููุฌุงุญ:**
```
๐ Database Configuration Debug:
  - DATABASE_URL: postgres://postgres:...
โ Using DATABASE_URL
[Nest] LOG [NestFactory] Starting Nest application...
[Nest] LOG [InstanceLoader] TypeOrmModule dependencies initialized
โ Ready in XXXms
```

**โ ูุฌุจ ุฃูุง ุชุฑู:**
```
Error: getaddrinfo EAI_AGAIN base
Unable to connect to the database
```

---

## ๐ฏ ุงููุชุงุฆุฌ ูุงูุชูุตูุงุช

### ูุง ุชู ุฅูุฌุงุฒู:
1. โ ุชุญุฏูุฏ ุงูุณุจุจ ุงูุฌุฐุฑู ูููุดููุฉ
2. โ ุงุฎุชุจุงุฑ ุงูุงุชุตุงู ุจูุงุนุฏุฉ ุงูุจูุงูุงุช ุจูุฌุงุญ
3. โ ุชุญุฏูุซ ุงูููุฏ ูุฏุนู ุฃูุถู
4. โ ุชูุซูู ุดุงูู ุจุงูุนุฑุจูุฉ ูุงูุฅูุฌููุฒูุฉ
5. โ ุฅูุดุงุก ุฃุฏูุงุช ุงุฎุชุจุงุฑ ูุชุดุฎูุต

### ุงูุชูุตูุฉ ุงูููุงุฆูุฉ:
**ุงุณุชุฎุฏู DATABASE_URL ููุท** - ุชู ุงุฎุชุจุงุฑูุง ูุชุนูู ุจุดูู ูุซุงูู.

### ูุนูููุงุช ูุงุนุฏุฉ ุงูุจูุงูุงุช:
- **ุงูููุน:** PostgreSQL 17.6
- **ุงููุถูู:** 72.60.92.146:5433
- **SSL:** ุบูุฑ ูุฏุนูู (ููุง ููุญุชุงุฌ)
- **ุงูุงุชุตุงู:** โ ุชู ุงูุชุญูู ูุงูุงุฎุชุจุงุฑ

---

## ๐ ููุงุฑูุฉ ุงูุทุฑู

| ุงูุทุฑููุฉ | ุงููุชูุฌุฉ | ุงูุณุฑุนุฉ | ุงูููุซูููุฉ | ุงูุชูุตูุฉ |
|---------|---------|--------|-----------|----------|
| DATABASE_URL | โ ูุฌุญ | ุณุฑูุน | ุนุงููุฉ | โญโญโญโญโญ ุงุณุชุฎุฏู ูุฐุง |
| ูุชุบูุฑุงุช ูููุตูุฉ + SSL | โ ูุดู | - | - | โ ูุง ุชุณุชุฎุฏู |
| ูุชุบูุฑุงุช ูููุตูุฉ ุจุฏูู SSL | ูู ููุฎุชุจุฑ | ูุชูุณุท | ูุชูุณุทุฉ | โญโญ ูููู ููู ุบูุฑ ุถุฑูุฑู |

---

## ๐ ุงูุชูุงุตูู ุงูุชูููุฉ

### ุงูุชุบููุฑุงุช ูู database.config.ts:

```typescript
// ุงููุฏูู: DATABASE_URL ุฃููุงู
if (databaseUrl) {
  return { type: 'postgres', url: databaseUrl, ... };
}
// ุซู ุงููุชุบูุฑุงุช ุงููุฑุฏูุฉ

// ุงูุฌุฏูุฏ: ุงููุชุบูุฑุงุช ุงููุฑุฏูุฉ ุฃููุงู (ุฃูุซุฑ ููุซูููุฉ)
if (dbHost && dbUsername && dbPassword && dbName) {
  console.log('โ Using individual database variables');
  return { type: 'postgres', host: dbHost, ... };
}
// ุซู DATABASE_URL ูุจุฏูู
if (databaseUrl) {
  console.log('โ Using DATABASE_URL');
  return { type: 'postgres', url: databaseUrl, ... };
}
```

### ููุงุฆุฏ ุงูุชุบููุฑุงุช:
1. ุฑุณุงุฆู ุชุตุญูุญ ูุงุถุญุฉ ููุชุชุจุน
2. ุฃููููุฉ ุฃูุถู ููุทุฑู ุงููุฎุชููุฉ
3. ุฑุณุงุฆู ุฎุทุฃ ูููุฏุฉ
4. ุฏุนู ุฃูุถู ููุณููุงุฑูููุงุช ุงููุฎุชููุฉ

---

## ๐ ุงููููุงุช ุงููุฑุฌุนูุฉ

### ููุจุฏุก ููุฑุงู:
1. `ุฎุทูุงุช-ุณุฑูุนุฉ-ูููุดุฑ.txt` โ **ุงุจุฏุฃ ููุง!**
2. `RECOMMENDED_ENV_VARS.txt` โ ุงูุณุฎ ุงููุชุบูุฑุงุช ูู ููุง

### ููุชูุงุตูู:
3. `README_DEPLOYMENT.md` โ ุฏููู ุดุงูู
4. `DATABASE_CONNECTION_TEST_RESULTS.md` โ ูุชุงุฆุฌ ุงูุงุฎุชุจุงุฑ
5. `DEPLOYMENT_FIXES_SUMMARY.md` โ ุงูุชูุงุตูู ุงูุชูููุฉ

### ููุงุฎุชุจุงุฑ:
6. `backend/test-db-connection.js` โ ุณูุฑูุจุช ุงุฎุชุจุงุฑ ุงูุงุชุตุงู
7. `backend/create-admin-postgres.js` โ ุฅูุดุงุก ูุณุชุฎุฏู ุฅุฏุงุฑู

---

## ๐ ุงูุฎูุงุตุฉ ุงูููุงุฆูุฉ

### ุงููุดููุฉ:
โ ูุชุบูุฑุงุช ุงูุจูุฆุฉ ุบูุฑ ูุญุฏุฏุฉ โ ุฎุทุฃ "base"

### ุงูุญู:
โ ุฅุถุงูุฉ DATABASE_URL ูุงููุชุบูุฑุงุช ุงููุทููุจุฉ ูู Coolify

### ุงูุญุงูุฉ:
โ **ุฌุงูุฒ ูููุดุฑ** - ุชู ุงูุงุฎุชุจุงุฑ ูุงูุชูุซูู ุจุงููุงูู

### ุงูุฎุทูุฉ ุงูุชุงููุฉ:
๐ ุงูุชุญ `ุฎุทูุงุช-ุณุฑูุนุฉ-ูููุดุฑ.txt` ูุงุจุฏุฃ ุงููุดุฑ!

---

**ุขุฎุฑ ุชุญุฏูุซ:** 2 ุฃูุชูุจุฑ 2025  
**ุงููุทูุฑ:** AI Assistant  
**ุงูุญุงูุฉ:** โ ููุชูู ูููุฎุชุจุฑ  
**ููุช ุงูุญู:** ~2 ุณุงุนุฉ

---

## ๐ ููุงุญุธุฉ ุฃุฎูุฑุฉ

ุฌููุน ุงูุฅุตูุงุญุงุช ูุงูุชุญุณููุงุช ุงููุทุจูุฉ:
- โ ููุฎุชุจุฑุฉ ููููุซููุฉ
- โ ุฌุงูุฒุฉ ููุฅูุชุงุฌ
- โ ุณููุฉ ุงูุชุทุจูู
- โ ููุซููุฉ ูุขููุฉ

**ุญุธุงู ููููุงู ูู ุงููุดุฑ! ๐**

