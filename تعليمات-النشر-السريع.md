# 🚀 تعليمات النشر السريع على Coolify

## ❌ المشكلة
التطبيق يفشل في الاتصال بقاعدة البيانات ويظهر الخطأ:
```
Error: getaddrinfo EAI_AGAIN base
```

## ✅ الحل
متغيرات البيئة غير محددة بشكل صحيح في Coolify.

---

## 📋 خطوات الحل (5 دقائق)

### 1️⃣ افتح Coolify
- اذهب إلى مشروعك في Coolify
- افتح قسم **Environment Variables**

### 2️⃣ احذف المتغيرات القديمة (إن وجدت)
- احذف أي متغيرات قد تحتوي على قيم خاطئة
- خاصة أي متغير يحتوي على "base"

### 3️⃣ أضف المتغيرات الجديدة
افتح الملف: **coolify-env-variables.txt**

انسخ جميع المتغيرات والصقها في Coolify:
```
NODE_ENV=production
PORT=3000
BACKEND_PORT=3001
FRONTEND_PORT=3000
DB_TYPE=postgres
DB_HOST=72.60.92.146
DB_PORT=5433
DB_USERNAME=postgres
DB_PASSWORD=A93zhpdV6icewK6rxbBQRScmxZvyWAhjvXg2QJApIKzU0gVx8CzubNgvo2O97n1l
DB_NAME=postgres
DB_SSL=false
DB_SSL_REJECT_UNAUTHORIZED=false
DB_SYNCHRONIZE=true
DB_LOGGING=false
JWT_SECRET=GoldenHorse-JWT-Secret-Key-2024-Production-Change-This
JWT_EXPIRES_IN=7d
CORS_ORIGIN=*
FRONTEND_URL=http://localhost:3000
APP_NAME=Golden Horse Shipping
APP_VERSION=1.0.0
DEFAULT_LANGUAGE=ar
UPLOAD_PATH=/app/uploads
SHIPSGO_API_URL=https://api.shipsgo.com/v1
SHIPSGO_API_KEY=6eada10b-fcd9-4ab8-ba19-3e2cb33fc1fa
SHIPSGO_USE_MOCK=false
NEXT_TELEMETRY_DISABLED=1
```

### 4️⃣ احفظ وأعد النشر
- انقر على **Save** أو **Update**
- انقر على **Redeploy**

### 5️⃣ تحقق من السجلات
بعد النشر، افتح سجلات الحاوية وابحث عن:

**✅ نجح:** يجب أن ترى:
```
🔍 Database Configuration Debug:
  - DB_HOST: 72.60.92.146
✅ Using individual database variables
[Nest] LOG [NestFactory] Starting Nest application...
[Nest] LOG [InstanceLoader] TypeOrmModule dependencies initialized
```

**❌ فشل:** إذا رأيت:
```
Error: getaddrinfo EAI_AGAIN base
```
تأكد من أن جميع المتغيرات مضافة بشكل صحيح.

---

## ⚠️ ملاحظات مهمة

1. **DB_SYNCHRONIZE=true** في النشر الأول
   - يقوم بإنشاء الجداول تلقائياً
   - بعد النشر الأول، غيّره إلى `false`

2. **تأكد من الوصول لقاعدة البيانات**
   - البورت 5433 يجب أن يكون مفتوحاً
   - العنوان 72.60.92.146 يجب أن يكون قابل للوصول من Coolify

3. **لا تستخدم DATABASE_URL**
   - استخدم المتغيرات المنفصلة (DB_HOST, DB_PORT, ...)
   - أكثر موثوقية في Coolify

---

## 📁 الملفات المفيدة

- **coolify-env-variables.txt** - قائمة المتغيرات للنسخ
- **COOLIFY_DEPLOYMENT_GUIDE.md** - دليل مفصل بالإنجليزية
- **COOLIFY_ENV_SETUP.md** - شرح الإعدادات

---

## 🆘 إذا استمرت المشكلة

1. تحقق من أن جميع المتغيرات مضافة
2. تأكد من عدم وجود مسافات قبل أو بعد القيم
3. جرّب حذف وإعادة إضافة المتغيرات
4. تحقق من أن قاعدة البيانات تعمل ويمكن الوصول إليها

---

**آخر تحديث:** 2 أكتوبر 2025

